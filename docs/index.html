<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0ea5e9">
    <title>应用下载 · Cloudrain</title>
    <meta name="description" content="Cloudrain 最新安卓 APK 下载，版本 1.3.2。">
    <meta property="og:title" content="Cloudrain 安卓 APK 下载">
    <meta property="og:description" content="Cloudrain 最新安卓 APK 下载，版本 1.3.2。">
    <meta property="og:image" content="icon-mini2.png?v=1.3.2">
    <meta property="og:type" content="website">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="icon" href="icon-mini2.png?v=1.3.2" sizes="96x96" type="image/png">
    <link rel="apple-touch-icon" href="icon-mini2.png?v=1.3.2">
    <link rel="preload" as="image" href="icon-mini2.png?v=1.3.2" imagesizes="(max-width:640px) 72px, 84px">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container fade-in">
        <header class="header">
            <div class="header-left">
                <div class="icon-wrap" aria-hidden="true">
                    <div class="icon-skeleton" aria-hidden="true"></div>
                    <img src="icon-mini2.png?v=1.3.2" alt="应用图标" class="app-icon" width="84" height="84" loading="eager" decoding="async" fetchpriority="high" />
                </div>
                <div class="title-wrap">
                    <h1 id="app-name" class="app-name">Cloudrain</h1>
                    <p class="subtitle">轻快、干净的小说创作 App</p>
                    <div class="badges">
                        <span class="badge os" aria-label="平台：Android">Android</span>
                        <span class="badge tag">离线可用</span>
                    </div>
                </div>
            </div>
        </header>
        <main>
            <section class="info-cards">
                <div class="info-card">
                    <span class="label">最新版本</span>
                    <span class="value" id="version">1.3.2</span>
                </div>
                <div class="info-card">
                    <span class="label">更新日期</span>
                    <span class="value" id="update-date">2025-12-18</span>
                </div>
                <div class="info-card">
                    <span class="label">文件大小</span>
                    <span class="value skeleton" id="apk-size">--</span>
                </div>
            </section>

            <div class="action-row">
                <a href="https://github.com/yanyan1115/NovelWriter/releases/download/v1.3.2_1/Cloudrain.apk" class="btn primary download-button" aria-label="前往 GitHub 进行国际下载">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 7h2v6h-2zm0 8h2v2h-2z" fill="currentColor"></path></svg>
                    <span>国际下载 (GitHub)</span>
                </a>
                <a href="https://www.123865.com/s/VwQCvd-5aZd3" class="btn secondary download-button" aria-label="国内稳定下载（123 云盘）">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M5 20h14a1 1 0 0 0 1-1v-3h-2v2H6v-2H4v3a1 1 0 0 0 1 1zm7-3 5-5h-3V4h-4v8H7l5 5z" fill="currentColor"></path></svg>
                    <span>国内下载 (123云盘)</span>
                </a>
                <button class="btn ghost" id="copy-link" data-url="https://www.123865.com/s/VwQCvd-5aZd3" aria-label="复制国内下载链接（123 云盘）">
                    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z" fill="currentColor"/></svg>
                    <span>复制下载链接</span>
                </button>
            </div>
            <p class="hint">如未自动开始下载：请点击“国内下载(123云盘)”进入分享页后再点击下载。</p>

            <section class="changelog panel">
                <details class="details" open>
                    <summary>更新日志</summary>
                    <pre id="changelog-content">Cloudrain 1.3.2（2025-12-18）
- 体验优化：启动更快，动画更顺滑
- 易用性：设置项更清晰，交互更一致
- 稳定性：弱网下载更可靠，降低后台耗电
- 修复：修复若干已知问题与偶发崩溃
- 安全：更新依赖与权限文案</pre>
                </details>
            </section>
        </main>
        <footer>
            <p>© 2025 Yanjun_Zhou · 保留所有权利</p>
        </footer>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 图标加载占位，加载完成后淡入
      const appIcon = document.querySelector('.app-icon');
      const iconSkeleton = document.querySelector('.icon-skeleton');
      function onIconDone() {
        if (iconSkeleton) iconSkeleton.classList.add('hide');
        if (appIcon) appIcon.classList.add('loaded');
      }
      if (appIcon?.complete) {
        // 如果已缓存，直接完成
        onIconDone();
      } else {
        appIcon?.addEventListener('load', onIconDone, { once: true });
        appIcon?.addEventListener('error', onIconDone, { once: true });
      }

      // 按钮下载处理（保留原有逻辑，优化非跨域直链体验）
      const downloadButtons = document.querySelectorAll('.download-button');
      if (downloadButtons.length) {
        downloadButtons.forEach(button => {
          button.addEventListener('click', async (event) => {
            const downloadButton = event.currentTarget;
            const url = downloadButton.href;
            // 跨域或 GitHub 等外链，直接交给浏览器
            if (/^https?:\/\//i.test(url) && !url.startsWith(location.origin)) {
              return;
            }
            event.preventDefault();
            const textEl = downloadButton.querySelector('span');
            const originalText = textEl ? textEl.textContent : '';
            if (downloadButton.classList.contains('disabled')) return;
            try {
              if (textEl) textEl.textContent = '正在准备...';
              downloadButton.classList.add('disabled');
              const response = await fetch(url);
              if (!response.ok) throw new Error(`下载失败: ${response.status} ${response.statusText}`);
              const blob = await response.blob();
              const blobUrl = window.URL.createObjectURL(blob);
              const tempLink = document.createElement('a');
              tempLink.style.display = 'none';
              tempLink.href = blobUrl;
              tempLink.setAttribute('download', url.split('/').pop());
              document.body.appendChild(tempLink);
              tempLink.click();
              document.body.removeChild(tempLink);
              window.URL.revokeObjectURL(blobUrl);
              if (textEl) textEl.textContent = '下载完成';
              setTimeout(() => {
                if (textEl) textEl.textContent = originalText || '';
                downloadButton.classList.remove('disabled');
              }, 2000);
            } catch (error) {
              console.error('下载出错:', error);
              if (textEl) textEl.textContent = '下载失败';
              setTimeout(() => {
                if (textEl) textEl.textContent = originalText || '';
                downloadButton.classList.remove('disabled');
              }, 3000);
            }
          });
        });
      }

      // 复制下载链接
      const toast = document.getElementById('toast');
      function showToast(msg) {
        if (!toast) return;
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2200);
      }
      const copyBtn = document.getElementById('copy-link');
      copyBtn?.addEventListener('click', async () => {
        const url = (copyBtn.getAttribute('data-url') || '').trim();
        // 兼容：既支持绝对链接，也支持相对路径
        const finalUrl = /^https?:\/\//i.test(url) ? url : new URL(url, location.href).href;
        try {
          await navigator.clipboard.writeText(finalUrl);
          showToast('已复制下载链接');
        } catch {
          // 旧浏览器降级
          const input = document.createElement('input');
          input.value = finalUrl;
          document.body.appendChild(input);
          input.select();
          document.execCommand('copy');
          document.body.removeChild(input);
          showToast('已复制下载链接');
        }
      });

      // 文件大小：123 云盘分享链接无法可靠获取 content-length，这里使用固定文案
      const apkSizeEl = document.getElementById('apk-size');
      if (apkSizeEl) {
        apkSizeEl.textContent = '约 147 MB';
        apkSizeEl.classList.remove('skeleton');
      }
    });
    </script>
</body>
</html>
